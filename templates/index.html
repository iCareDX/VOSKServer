<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Recognized Text and LLM Response</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script type="text/javascript" charset="utf-8">
      document.addEventListener('DOMContentLoaded', (event) => {
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('update_text', function(data) {
          var historyContainer = document.getElementById('conversation_history');

          // 既存のハイライトをクリア
          var highlighted = document.querySelectorAll('.highlight');
          highlighted.forEach(function(item) {
            item.classList.remove('highlight');
          });

          // 最新のメッセージを追加してハイライトする
          let userText = document.createElement('p');
          userText.innerText = "User: " + data.recognized_text_history[data.recognized_text_history.length - 1];
          userText.classList.add('highlight'); // ハイライトクラスを追加
          historyContainer.appendChild(userText);

          let aiText = document.createElement('p');
          aiText.innerText = "AI: " + data.llm_response_history[data.llm_response_history.length - 1];
          aiText.classList.add('highlight'); // ハイライトクラスを追加
          historyContainer.appendChild(aiText);

          // 最新のメッセージに自動スクロール
          historyContainer.scrollTop = historyContainer.scrollHeight;
        });
      });
    </script>
    <style>
      #conversation_history {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
        display: flex;
        flex-direction: column-reverse; /* 最新のメッセージが下に来るようにする */
      }
      .highlight {
        background-color: #ffffcc; /* ハイライトの背景色 */
        font-weight: bold; /* 文字を太字に */
      }
    </style>
  </head>
  <body>
    <h1>Conversation History</h1>
    <div id="conversation_history"></div>
  </body>
</html>
